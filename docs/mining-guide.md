# BitNice PoW æŒ–çŸ¿è¯¦ç»†æŒ‡å—

## ğŸ“‹ ç›®å½•

- [æŒ–çŸ¿æ¦‚è¿°](#æŒ–çŸ¿æ¦‚è¿°)
- [æŒ–çŸ¿ç¯å¢ƒè®¾ç½®](#æŒ–çŸ¿ç¯å¢ƒè®¾ç½®)
- [å¯åŠ¨æŒ–çŸ¿èŠ‚ç‚¹](#å¯åŠ¨æŒ–çŸ¿èŠ‚ç‚¹)
- [æŒ–çŸ¿ç­–ç•¥ä¸ä¼˜åŒ–](#æŒ–çŸ¿ç­–ç•¥ä¸ä¼˜åŒ–)
- [ç›‘æ§ä¸ç»´æŠ¤](#ç›‘æ§ä¸ç»´æŠ¤)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [ç»æµæ¨¡å‹](#ç»æµæ¨¡å‹)

## æŒ–çŸ¿æ¦‚è¿°

BitNice é‡‡ç”¨æ¯”ç‰¹å¸é£æ ¼çš„ SHA-256 å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰å…±è¯†ç®—æ³•ï¼Œç»“åˆ GRANDPA æœ€ç»ˆæ€§æœºåˆ¶ã€‚æŒ–çŸ¿æ˜¯ç½‘ç»œå®‰å…¨çš„æ ¸å¿ƒï¼ŒçŸ¿å·¥é€šè¿‡è®¡ç®—å·¥ä½œé‡è¯æ˜æ¥ç”Ÿäº§æ–°åŒºå—å¹¶è·å¾—å¥–åŠ±ã€‚

### ğŸ¯ æŒ–çŸ¿ç‰¹æ€§

- **ç®—æ³•**: SHA-256 å·¥ä½œé‡è¯æ˜
- **åŒºå—æ—¶é—´**: 6 ç§’ç›®æ ‡æ—¶é—´
- **éš¾åº¦è°ƒæ•´**: åŠ¨æ€éš¾åº¦è°ƒæ•´ç®—æ³•
- **å¥–åŠ±**: åŒºå—å¥–åŠ± + äº¤æ˜“æ‰‹ç»­è´¹
- **æœ€ç»ˆæ€§**: GRANDPA å¿«é€Ÿæœ€ç»ˆæ€§ç¡®è®¤

### ğŸ” æŒ–çŸ¿åŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PoW æŒ–çŸ¿æµç¨‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ”¶é›†äº¤æ˜“                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ â€¢ ä»äº¤æ˜“æ± è·å–å¾…å¤„ç†äº¤æ˜“                             â”‚ â”‚
â”‚     â”‚ â€¢ éªŒè¯äº¤æ˜“æœ‰æ•ˆæ€§                                     â”‚ â”‚
â”‚     â”‚ â€¢ æŒ‰æ‰‹ç»­è´¹æ’åº                                       â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. æ„å»ºåŒºå—                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ â€¢ åˆ›å»ºåŒºå—å¤´                                         â”‚ â”‚
â”‚     â”‚ â€¢ è®¡ç®— Merkle æ ¹                                     â”‚ â”‚
â”‚     â”‚ â€¢ è®¾ç½®æ—¶é—´æˆ³                                         â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. è®¡ç®—å·¥ä½œé‡è¯æ˜                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ â€¢ è·å–å½“å‰éš¾åº¦ç›®æ ‡                                   â”‚ â”‚
â”‚     â”‚ â€¢ å°è¯•ä¸åŒçš„ nonce å€¼                                â”‚ â”‚
â”‚     â”‚ â€¢ è®¡ç®— SHA-256 å“ˆå¸Œ                                  â”‚ â”‚
â”‚     â”‚ â€¢ æ£€æŸ¥æ˜¯å¦æ»¡è¶³éš¾åº¦è¦æ±‚                               â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. å¹¿æ’­åŒºå—                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ â€¢ éªŒè¯åŒºå—æœ‰æ•ˆæ€§                                     â”‚ â”‚
â”‚     â”‚ â€¢ å¹¿æ’­åˆ° P2P ç½‘ç»œ                                    â”‚ â”‚
â”‚     â”‚ â€¢ ç­‰å¾…ç½‘ç»œç¡®è®¤                                       â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŒ–çŸ¿ç¯å¢ƒè®¾ç½®

### ğŸ“‹ ç¡¬ä»¶è¦æ±‚

#### æœ€ä½é…ç½®
- **CPU**: 4 æ ¸å¿ƒï¼Œ2.0GHz ä»¥ä¸Š
- **å†…å­˜**: 8GB RAM
- **å­˜å‚¨**: 100GB å¯ç”¨ç©ºé—´ï¼ˆSSD æ¨èï¼‰
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆ10Mbps+ï¼‰

#### æ¨èé…ç½®
- **CPU**: 8+ æ ¸å¿ƒï¼Œ3.0GHz ä»¥ä¸Šï¼ˆæ”¯æŒ SHA æ‰©å±•æŒ‡ä»¤ï¼‰
- **å†…å­˜**: 16GB+ RAM
- **å­˜å‚¨**: 500GB+ SSD
- **ç½‘ç»œ**: é«˜é€Ÿç¨³å®šè¿æ¥ï¼ˆ100Mbps+ï¼‰

#### ä¼ä¸šçº§é…ç½®
- **CPU**: 16+ æ ¸å¿ƒï¼Œé«˜é¢‘ CPUï¼ˆå¦‚ Intel Core i9, AMD Ryzen 9ï¼‰
- **å†…å­˜**: 32GB+ RAM
- **å­˜å‚¨**: 1TB+ NVMe SSD
- **GPU**: æ”¯æŒ CUDA/OpenCLï¼ˆæœªæ¥ç‰ˆæœ¬å¯èƒ½æ”¯æŒï¼‰
- **ç½‘ç»œ**: åƒå…†ç½‘ç»œè¿æ¥

### ğŸ› ï¸ è½¯ä»¶ç¯å¢ƒ

#### æ“ä½œç³»ç»Ÿé€‰æ‹©
```bash
# Ubuntu 20.04/22.04 LTS (æ¨è)
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL 8+
sudo dnf update -y

# Arch Linux
sudo pacman -Syu

# macOS (å¼€å‘ç¯å¢ƒ)
brew update && brew upgrade
```

#### ç³»ç»Ÿä¼˜åŒ–è®¾ç½®
```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo "* soft nofile 65536" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 65536" | sudo tee -a /etc/security/limits.conf

# è°ƒæ•´ç½‘ç»œå‚æ•°
echo "net.core.rmem_max = 268435456" | sudo tee -a /etc/sysctl.conf
echo "net.core.wmem_max = 268435456" | sudo tee -a /etc/sysctl.conf
echo "net.core.netdev_max_backlog = 5000" | sudo tee -a /etc/sysctl.conf

# åº”ç”¨ç³»ç»Ÿè®¾ç½®
sudo sysctl -p
```

### âš¡ ç¼–è¯‘ä¼˜åŒ–

#### é’ˆå¯¹æŒ–çŸ¿çš„ç¼–è¯‘ä¼˜åŒ–
```bash
# è®¾ç½®ç¼–è¯‘æ ‡å¿—
export RUSTFLAGS="-C target-cpu=native -C opt-level=3"
export CARGO_PROFILE_RELEASE_LTO=true

# ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬
cargo build --release --features runtime-benchmarks

# éªŒè¯äºŒè¿›åˆ¶æ–‡ä»¶
ldd target/release/node-template  # æ£€æŸ¥åŠ¨æ€é“¾æ¥
strip target/release/node-template  # å‡å°æ–‡ä»¶å¤§å°
```

#### CPU ç‰¹å®šä¼˜åŒ–
```bash
# æ£€æŸ¥ CPU ç‰¹æ€§
cat /proc/cpuinfo | grep flags | head -1

# Intel CPU ä¼˜åŒ–
export RUSTFLAGS="-C target-cpu=native -C target-feature=+aes,+sha"

# AMD CPU ä¼˜åŒ–  
export RUSTFLAGS="-C target-cpu=native -C target-feature=+sha"
```

## å¯åŠ¨æŒ–çŸ¿èŠ‚ç‚¹

### ğŸš€ åŸºç¡€æŒ–çŸ¿å¯åŠ¨

#### å•èŠ‚ç‚¹æŒ–çŸ¿ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰
```bash
# å¯åŠ¨å¼€å‘æŒ–çŸ¿èŠ‚ç‚¹
./target/release/node-template \
    --dev \
    --mining \
    --mine \
    --base-path /tmp/bitnice-mining \
    --port 30333 \
    --rpc-port 9933 \
    --validator

# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/bitnice-mining/bitnice.log
```

#### ç”Ÿäº§ç¯å¢ƒæŒ–çŸ¿
```bash
# åˆ›å»ºæŒ–çŸ¿é…ç½®ç›®å½•
mkdir -p ~/bitnice-miner/{data,logs,keys}

# ç”ŸæˆæŒ–çŸ¿è´¦æˆ·
./target/release/node-template key generate --scheme sr25519 --output-type json > ~/bitnice-miner/keys/mining-key.json

# å¯åŠ¨æŒ–çŸ¿èŠ‚ç‚¹
./target/release/node-template \
    --validator \
    --mining \
    --name "BitNice-Miner-$(hostname)" \
    --chain local \
    --base-path ~/bitnice-miner/data \
    --port 30333 \
    --rpc-port 9933 \
    --rpc-cors all \
    --rpc-methods unsafe \
    --key-file ~/bitnice-miner/keys/mining-key.json \
    --mining-threads $(nproc) \
    2>&1 | tee ~/bitnice-miner/logs/miner.log
```

### âš™ï¸ é«˜çº§æŒ–çŸ¿é…ç½®

#### å¤šçº¿ç¨‹æŒ–çŸ¿
```bash
# è·å– CPU æ ¸å¿ƒæ•°
CORES=$(nproc)
echo "æ£€æµ‹åˆ° $CORES ä¸ª CPU æ ¸å¿ƒ"

# é…ç½®æŒ–çŸ¿çº¿ç¨‹ï¼ˆå»ºè®®ä¿ç•™ 1-2 ä¸ªæ ¸å¿ƒç»™ç³»ç»Ÿï¼‰
MINING_THREADS=$((CORES - 2))

./target/release/node-template \
    --validator \
    --mining \
    --mining-threads $MINING_THREADS \
    --base-path ~/bitnice-miner/data
```

#### å†…å­˜æ± ä¼˜åŒ–
```bash
./target/release/node-template \
    --validator \
    --mining \
    --pool-limit 10000 \
    --pool-kbytes 40960 \
    --base-path ~/bitnice-miner/data
```

#### ç½‘ç»œä¼˜åŒ–
```bash
./target/release/node-template \
    --validator \
    --mining \
    --max-parallel-downloads 8 \
    --in-peers 50 \
    --out-peers 100 \
    --base-path ~/bitnice-miner/data
```

### ğŸ”§ æŒ–çŸ¿æ± é…ç½®

#### é…ç½®æ–‡ä»¶æ–¹å¼
```toml
# mining-config.toml
[mining]
enabled = true
threads = 6
algorithm = "sha256"

[network]
port = 30333
max_peers = 150
boot_nodes = [
    "/ip4/192.168.1.100/tcp/30333/p2p/12D3KooW...",
    "/ip4/10.0.0.50/tcp/30333/p2p/12D3KooW..."
]

[rpc]
port = 9933
cors = "all"
methods = "unsafe"

[database]
cache_size = 1024  # MB
path = "/data/bitnice"
```

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨
./target/release/node-template --config mining-config.toml
```

## æŒ–çŸ¿ç­–ç•¥ä¸ä¼˜åŒ–

### ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡

#### å…³é”®æŒ–çŸ¿æŒ‡æ ‡
```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > monitor-mining.sh << 'EOF'
#!/bin/bash

echo "=== BitNice æŒ–çŸ¿æ€§èƒ½ç›‘æ§ ==="
echo "æ—¶é—´: $(date)"
echo

# CPU ä½¿ç”¨ç‡
echo "CPU ä½¿ç”¨ç‡:"
top -bn1 | grep "node-template" | awk '{print $9"%"}'

# å†…å­˜ä½¿ç”¨
echo "å†…å­˜ä½¿ç”¨:"
ps aux | grep node-template | awk '{print $6/1024 " MB"}'

# ç½‘ç»œè¿æ¥
echo "ç½‘ç»œè¿æ¥æ•°:"
ss -tuln | grep -E "(30333|9933)" | wc -l

# ç£ç›˜ä½¿ç”¨
echo "æ•°æ®ç›®å½•å¤§å°:"
du -sh ~/bitnice-miner/data

# æŒ–çŸ¿ç»Ÿè®¡ï¼ˆä»æ—¥å¿—æå–ï¼‰
echo "æœ€è¿‘æŒ–åˆ°çš„åŒºå—:"
tail -100 ~/bitnice-miner/logs/miner.log | grep "âœ¨ Imported" | tail -5

echo "å½“å‰éš¾åº¦:"
curl -s -H "Content-Type: application/json" \
  -d '{"id":1, "jsonrpc":"2.0", "method": "pow_difficulty", "params":[]}' \
  http://localhost:9933 | jq '.result'

EOF

chmod +x monitor-mining.sh
```

#### å®æ—¶ç›‘æ§ä»ªè¡¨æ¿
```bash
# å®‰è£… htop å’Œ iotop
sudo apt install htop iotop nethogs

# ç›‘æ§ CPU å’Œå†…å­˜
htop -p $(pgrep node-template)

# ç›‘æ§ç£ç›˜ I/O
sudo iotop -p $(pgrep node-template)

# ç›‘æ§ç½‘ç»œ
sudo nethogs -p $(pgrep node-template)
```

### âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§

#### 1. CPU ä¼˜åŒ–
```bash
# è®¾ç½® CPU è°ƒåº¦å™¨ä¸ºæ€§èƒ½æ¨¡å¼
echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor

# ç¦ç”¨ CPU èŠ‚èƒ½
sudo cpupower frequency-set -g performance

# è®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§
sudo renice -10 $(pgrep node-template)

# ç»‘å®šåˆ°ç‰¹å®š CPU æ ¸å¿ƒï¼ˆå¯é€‰ï¼‰
taskset -c 0-5 ./target/release/node-template --mining
```

#### 2. å†…å­˜ä¼˜åŒ–
```bash
# è°ƒæ•´äº¤æ¢åˆ†åŒºä½¿ç”¨
echo 'vm.swappiness=10' | sudo tee -a /etc/sysctl.conf

# å¢åŠ è„é¡µç¼“å­˜
echo 'vm.dirty_ratio=15' | sudo tee -a /etc/sysctl.conf
echo 'vm.dirty_background_ratio=5' | sudo tee -a /etc/sysctl.conf

# åº”ç”¨è®¾ç½®
sudo sysctl -p
```

#### 3. å­˜å‚¨ä¼˜åŒ–
```bash
# å¦‚æœä½¿ç”¨ SSDï¼Œå¯ç”¨ TRIM
sudo systemctl enable fstrim.timer

# è°ƒæ•´ I/O è°ƒåº¦å™¨
echo noop | sudo tee /sys/block/*/queue/scheduler

# æŒ‚è½½é€‰é¡¹ä¼˜åŒ–ï¼ˆåœ¨ /etc/fstab ä¸­ï¼‰
# /dev/sda1 /data ext4 defaults,noatime,nodiratime 0 2
```

### ğŸ¯ æŒ–çŸ¿ç­–ç•¥

#### éš¾åº¦è‡ªé€‚åº”ç­–ç•¥
```rust
// åœ¨ runtime/src/lib.rs ä¸­å®ç°è‡ªå®šä¹‰éš¾åº¦è°ƒæ•´
impl sp_consensus_pow::DifficultyApi<Block, Difficulty> for Runtime {
    fn difficulty() -> Difficulty {
        let current_difficulty = Self::current_difficulty();
        let target_block_time = 6_000; // 6 ç§’ï¼Œæ¯«ç§’
        let adjustment_period = 10; // æ¯ 10 ä¸ªåŒºå—è°ƒæ•´ä¸€æ¬¡
        
        if let Some(recent_times) = Self::get_recent_block_times(adjustment_period) {
            let avg_time = recent_times.iter().sum::<u64>() / recent_times.len() as u64;
            
            if avg_time > target_block_time * 110 / 100 {
                // æ…¢äºç›®æ ‡æ—¶é—´ 10%ï¼Œé™ä½éš¾åº¦
                current_difficulty * 95 / 100
            } else if avg_time < target_block_time * 90 / 100 {
                // å¿«äºç›®æ ‡æ—¶é—´ 10%ï¼Œæé«˜éš¾åº¦
                current_difficulty * 105 / 100
            } else {
                current_difficulty
            }
        } else {
            current_difficulty
        }
    }
}
```

#### å¥–åŠ±æœ€å¤§åŒ–ç­–ç•¥
```bash
# ç›‘æ§å†…å­˜æ± ï¼Œä¼˜å…ˆé€‰æ‹©é«˜æ‰‹ç»­è´¹äº¤æ˜“
curl -s -H "Content-Type: application/json" \
  -d '{"id":1, "jsonrpc":"2.0", "method": "author_pendingExtrinsics", "params":[]}' \
  http://localhost:9933 | jq '.result | length'

# è°ƒæ•´åŒºå—å¤§å°ä»¥åŒ…å«æ›´å¤šäº¤æ˜“
./target/release/node-template \
  --mining \
  --max-block-size 4194304  # 4MB
```

## ç›‘æ§ä¸ç»´æŠ¤

### ğŸ“ˆ ç›‘æ§ç³»ç»Ÿè®¾ç½®

#### ä½¿ç”¨ Prometheus + Grafana
```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'bitnice-miner'
    static_configs:
      - targets: ['localhost:9615']  # Substrate metrics ç«¯å£
```

```bash
# å¯åŠ¨å¸¦ç›‘æ§çš„æŒ–çŸ¿èŠ‚ç‚¹
./target/release/node-template \
  --mining \
  --prometheus-external \
  --prometheus-port 9615 \
  --base-path ~/bitnice-miner/data
```

#### è‡ªå®šä¹‰ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# bitnice-health-check.sh

LOG_FILE="~/bitnice-miner/logs/miner.log"
ALERT_EMAIL="admin@example.com"

# æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¿è¡Œ
if ! pgrep -f "node-template.*mining" > /dev/null; then
    echo "è­¦å‘Š: BitNice æŒ–çŸ¿èŠ‚ç‚¹æœªè¿è¡Œ!" | mail -s "æŒ–çŸ¿èŠ‚ç‚¹å‘Šè­¦" $ALERT_EMAIL
    exit 1
fi

# æ£€æŸ¥æœ€è¿‘æ˜¯å¦æœ‰æ–°åŒºå—
LAST_BLOCK_TIME=$(tail -100 $LOG_FILE | grep "âœ¨ Imported" | tail -1 | awk '{print $1}')
CURRENT_TIME=$(date +%s)
TIME_DIFF=$((CURRENT_TIME - $(date -d "$LAST_BLOCK_TIME" +%s)))

if [ $TIME_DIFF -gt 300 ]; then  # 5 åˆ†é’Ÿæ²¡æœ‰æ–°åŒºå—
    echo "è­¦å‘Š: å·²ç» $TIME_DIFF ç§’æ²¡æœ‰æ”¶åˆ°æ–°åŒºå—!" | mail -s "åŒºå—åŒæ­¥å‘Šè­¦" $ALERT_EMAIL
fi

# æ£€æŸ¥æŒ–çŸ¿æ•ˆç‡
HASH_RATE=$(tail -100 $LOG_FILE | grep "mining.*hashes/sec" | tail -1 | awk '{print $NF}')
echo "å½“å‰å“ˆå¸Œç‡: $HASH_RATE"
```

### ğŸ”„ è‡ªåŠ¨åŒ–ç»´æŠ¤

#### ç³»ç»ŸæœåŠ¡é…ç½®
```ini
# /etc/systemd/system/bitnice-miner.service
[Unit]
Description=BitNice Mining Node
After=network.target

[Service]
Type=simple
User=bitnice
ExecStart=/home/bitnice/bitnice/target/release/node-template \
    --validator \
    --mining \
    --base-path /home/bitnice/bitnice-miner/data \
    --chain local
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨å’Œå¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable bitnice-miner
sudo systemctl start bitnice-miner

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status bitnice-miner
sudo journalctl -u bitnice-miner -f
```

#### è‡ªåŠ¨å¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# backup-mining-data.sh

BACKUP_DIR="/backup/bitnice"
DATA_DIR="~/bitnice-miner/data"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# åœæ­¢æŒ–çŸ¿ï¼ˆå¯é€‰ï¼Œä¸ºäº†æ•°æ®ä¸€è‡´æ€§ï¼‰
sudo systemctl stop bitnice-miner

# å‹ç¼©å’Œå¤‡ä»½
tar -czf "$BACKUP_DIR/bitnice-data-$DATE.tar.gz" -C "$(dirname $DATA_DIR)" "$(basename $DATA_DIR)"

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘ 7 å¤©ï¼‰
find $BACKUP_DIR -name "bitnice-data-*.tar.gz" -mtime +7 -delete

# é‡å¯æŒ–çŸ¿
sudo systemctl start bitnice-miner

echo "å¤‡ä»½å®Œæˆ: bitnice-data-$DATE.tar.gz"
```

### ğŸ“Š æ€§èƒ½åˆ†æ

#### æŒ–çŸ¿æ•ˆç‡åˆ†æ
```bash
# åˆ†ææŒ–çŸ¿æ—¥å¿—
cat ~/bitnice-miner/logs/miner.log | grep "âœ¨ Imported" | \
  awk '{print $1}' | \
  while read timestamp; do
    echo $(date -d "$timestamp" +%s)
  done | \
  awk '{
    if (NR > 1) {
      diff = $1 - prev
      sum += diff
      count++
    }
    prev = $1
  } END {
    if (count > 0) {
      avg = sum / count
      printf "å¹³å‡åŒºå—é—´éš”: %.2f ç§’\n", avg
      printf "ç†è®ºå“ˆå¸Œç‡: %.2f H/s\n", 2^32 / avg / difficulty
    }
  }'
```

#### èµ„æºä½¿ç”¨è¶‹åŠ¿
```bash
# åˆ›å»ºæ€§èƒ½å†å²è®°å½•
cat > record-performance.sh << 'EOF'
#!/bin/bash

PERF_LOG="~/bitnice-miner/logs/performance.log"

while true; do
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
    CPU_USAGE=$(top -bn1 | grep "node-template" | awk '{print $9}')
    MEM_USAGE=$(ps aux | grep node-template | awk '{sum+=$6} END {print sum/1024}')
    DISK_USAGE=$(du -sm ~/bitnice-miner/data | awk '{print $1}')
    
    echo "$TIMESTAMP,$CPU_USAGE,$MEM_USAGE,$DISK_USAGE" >> $PERF_LOG
    sleep 60
done
EOF

chmod +x record-performance.sh
nohup ./record-performance.sh &
```

## æ•…éšœæ’é™¤

### ğŸš¨ å¸¸è§é—®é¢˜è¯Šæ–­

#### 1. æŒ–çŸ¿èŠ‚ç‚¹æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tuln | grep -E "(30333|9933)"

# æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
ls -la ~/bitnice-miner/data

# æŸ¥çœ‹å¯åŠ¨é”™è¯¯
./target/release/node-template --mining --dev -l debug 2>&1 | head -50
```

#### 2. æŒ–çŸ¿æ•ˆç‡ä½ä¸‹
```bash
# æ£€æŸ¥ CPU é¢‘ç‡
cat /proc/cpuinfo | grep MHz

# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
uptime

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# æ£€æŸ¥ç£ç›˜ I/O
iostat -x 1 5
```

#### 3. ç½‘ç»œåŒæ­¥é—®é¢˜
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -s -H "Content-Type: application/json" \
  -d '{"id":1, "jsonrpc":"2.0", "method": "system_health", "params":[]}' \
  http://localhost:9933

# æ£€æŸ¥å¯¹ç­‰èŠ‚ç‚¹
curl -s -H "Content-Type: application/json" \
  -d '{"id":1, "jsonrpc":"2.0", "method": "system_peers", "params":[]}' \
  http://localhost:9933 | jq '.result | length'

# é‡æ–°åŒæ­¥ï¼ˆåˆ é™¤æ•°æ®åº“ï¼‰
rm -rf ~/bitnice-miner/data/chains/*/db
./target/release/node-template --mining --dev
```

### ğŸ”§ æ€§èƒ½è°ƒä¼˜

#### ç³»ç»Ÿçº§ä¼˜åŒ–
```bash
# è°ƒæ•´å†…æ ¸å‚æ•°
echo 'kernel.sched_migration_cost_ns = 5000000' | sudo tee -a /etc/sysctl.conf
echo 'kernel.sched_autogroup_enabled = 0' | sudo tee -a /etc/sysctl.conf

# å…³é—­ä¸å¿…è¦çš„æœåŠ¡
sudo systemctl disable bluetooth
sudo systemctl disable cups
sudo systemctl disable NetworkManager

# è®¾ç½® CPU äº²å’Œæ€§
echo 0-3 | sudo tee /sys/fs/cgroup/cpuset/background/cpuset.cpus
echo 4-7 | sudo tee /sys/fs/cgroup/cpuset/mining/cpuset.cpus
```

#### åº”ç”¨çº§ä¼˜åŒ–
```bash
# ç¯å¢ƒå˜é‡ä¼˜åŒ–
export RUST_BACKTRACE=0  # ç¦ç”¨å›æº¯ä»¥æé«˜æ€§èƒ½
export MALLOC_CONF="narenas:4,dirty_decay_ms:0,muzzy_decay_ms:0"

# JVM é£æ ¼çš„å†…å­˜é¢„åˆ†é…ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
export BITNICE_HEAP_SIZE=8G
```

## ç»æµæ¨¡å‹

### ğŸ’° å¥–åŠ±æœºåˆ¶

#### åŒºå—å¥–åŠ±ç»“æ„
```
åˆå§‹åŒºå—å¥–åŠ±: 50 BN
å‡åŠå‘¨æœŸ: æ¯ 210,000 ä¸ªåŒºå—ï¼ˆçº¦ 1 å¹´ï¼‰
æœ€ç»ˆæ€»é‡: 21 äº¿ BN

å¥–åŠ±åˆ†é…:
â”œâ”€â”€ åŸºç¡€åŒºå—å¥–åŠ±: 50 BN â†’ 25 BN â†’ 12.5 BN â†’ ...
â”œâ”€â”€ äº¤æ˜“æ‰‹ç»­è´¹: åŠ¨æ€è´¹ç”¨
â””â”€â”€ éš¾åº¦å¥–åŠ±: åŸºäºå®é™…éš¾åº¦çš„é¢å¤–å¥–åŠ±
```

#### æ‰‹ç»­è´¹ä¼˜åŒ–
```bash
# æŸ¥è¯¢å½“å‰æœ€ä½æ‰‹ç»­è´¹
curl -s -H "Content-Type: application/json" \
  -d '{"id":1, "jsonrpc":"2.0", "method": "payment_queryInfo", "params":[...]}' \
  http://localhost:9933

# ä¼˜åŒ–äº¤æ˜“é€‰æ‹©ç­–ç•¥
./target/release/node-template \
  --mining \
  --tx-pool-limit 10000 \
  --min-gas-price 1000000000  # æœ€ä½æ‰‹ç»­è´¹
```

### ğŸ“Š ç›ˆåˆ©èƒ½åŠ›è®¡ç®—

#### æˆæœ¬æ•ˆç›Šåˆ†æ
```bash
# è®¡ç®—æŒ–çŸ¿æˆæœ¬
cat > calculate-profitability.sh << 'EOF'
#!/bin/bash

# è¾“å…¥å‚æ•°
POWER_CONSUMPTION=500  # ç“¦ç‰¹
ELECTRICITY_COST=0.12  # æ¯åº¦ç”µæˆæœ¬ï¼ˆç¾å…ƒï¼‰
HASH_RATE=1000000      # å“ˆå¸Œç‡ï¼ˆH/sï¼‰
BN_PRICE=0.10          # BN ä»·æ ¼ï¼ˆç¾å…ƒï¼‰

# è®¡ç®—æ¯æ—¥æˆæœ¬
DAILY_POWER_COST=$(echo "$POWER_CONSUMPTION * 24 * $ELECTRICITY_COST / 1000" | bc -l)

# ä¼°ç®—æ¯æ—¥æŒ–çŸ¿æ”¶ç›Šï¼ˆéœ€è¦å®é™…éš¾åº¦æ•°æ®ï¼‰
DAILY_BLOCKS=14400  # 24å°æ—¶ * 3600ç§’ / 6ç§’
BLOCK_REWARD=50     # å½“å‰åŒºå—å¥–åŠ±

# æ ¹æ®å…¨ç½‘å“ˆå¸Œç‡ä¼°ç®—æ”¶ç›Š
NETWORK_HASH_RATE=10000000000  # å‡è®¾å…¨ç½‘å“ˆå¸Œç‡
MY_SHARE=$(echo "$HASH_RATE / $NETWORK_HASH_RATE" | bc -l)
DAILY_REWARD=$(echo "$DAILY_BLOCKS * $BLOCK_REWARD * $MY_SHARE" | bc -l)
DAILY_REVENUE=$(echo "$DAILY_REWARD * $BN_PRICE" | bc -l)

# å‡€åˆ©æ¶¦
NET_PROFIT=$(echo "$DAILY_REVENUE - $DAILY_POWER_COST" | bc -l)

echo "æ¯æ—¥æŒ–çŸ¿åˆ†æ:"
echo "ç”µè´¹æˆæœ¬: \$$(printf '%.2f' $DAILY_POWER_COST)"
echo "æŒ–çŸ¿æ”¶ç›Š: \$$(printf '%.2f' $DAILY_REVENUE)"
echo "å‡€åˆ©æ¶¦: \$$(printf '%.2f' $NET_PROFIT)"

EOF

chmod +x calculate-profitability.sh
./calculate-profitability.sh
```

---

## æ€»ç»“

BitNice PoW æŒ–çŸ¿éœ€è¦åˆç†çš„ç¡¬ä»¶é…ç½®ã€ç³»ç»Ÿä¼˜åŒ–å’ŒæŒç»­ç›‘æ§ã€‚é€šè¿‡æœ¬æŒ‡å—çš„è¯¦ç»†è®¾ç½®å’Œä¼˜åŒ–å»ºè®®ï¼Œæ‚¨å¯ä»¥ï¼š

1. **é«˜æ•ˆå¯åŠ¨**: å¿«é€Ÿé…ç½®å’Œå¯åŠ¨æŒ–çŸ¿èŠ‚ç‚¹
2. **æ€§èƒ½ä¼˜åŒ–**: æœ€å¤§åŒ–æŒ–çŸ¿æ•ˆç‡å’Œæ”¶ç›Š
3. **ç¨³å®šè¿è¡Œ**: é€šè¿‡ç›‘æ§å’Œç»´æŠ¤ç¡®ä¿é•¿æœŸç¨³å®š
4. **é—®é¢˜è§£å†³**: å¿«é€Ÿè¯Šæ–­å’Œè§£å†³å¸¸è§é—®é¢˜

è®°ä½ï¼ŒæŒ–çŸ¿æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å®šæœŸç»´æŠ¤å’Œä¼˜åŒ–ã€‚å»ºè®®å®šæœŸæŸ¥çœ‹æ—¥å¿—ã€ç›‘æ§æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶æ ¹æ®ç½‘ç»œå˜åŒ–è°ƒæ•´ç­–ç•¥ã€‚

**ç¥æ‚¨æŒ–çŸ¿æ„‰å¿«ï¼** â›ï¸ğŸ’ 